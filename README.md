# 동행복권 로또 자동 구매 프로그램

동행복권(dhlottery.co.kr)에서 로또 6/45를 자동으로 구매하는 Go 기반 프로그램입니다.

## 기능

- ✅ 동행복권 로그인
- ✅ 로또 6/45 구매 페이지 접근
- ✅ 환경변수, 설정 파일, 대화형 입력 지원
- ✅ **자동번호 로또 구매 (1~5게임)**
- ✅ **구매 결과 및 번호 출력**
- ✅ **오류 처리 (한도 초과, 예치금 부족 등)**
- ✅ **텔레그램 알림 기능**
- ✅ **스케줄러 (Cron) 지원**
- ✅ **서비스 모드 (24/7 실행)**

## 스케줄

### 자동 실행 스케줄
- **매주 월요일 13:00**: 예치금 확인 (10,000원 미만 시 텔레그램 알림)
- **매주 월요일 19:00**: 로또 5게임 자동 구매 (결과 텔레그램 알림)

## ⚠️ 주의사항

**이 프로그램은 실제 금액이 결제됩니다!**

- 온라인 구매 한도: 1회차당 최대 5,000원 (5게임)
- 구매 전 예치금 잔액을 확인하세요
- 테스트 시에도 실제 구매가 진행됩니다
- 책임감 있는 복권 구매를 권장합니다

## 요구사항

- Go 1.24.0 이상
- Windows 11 / Ubuntu 20.04 이상
- 동행복권 회원 가입 및 예치금 충전
- (선택) 텔레그램 봇 및 그룹 채팅

## 설치 방법

```powershell
# 프로젝트 디렉토리로 이동
cd C:\Projects\ETC-Projects\DhLottery

# 의존성 설치
go mod download
```

## 사용 방법

### 실행 모드

프로그램은 3가지 모드로 실행할 수 있습니다:

#### 1. 서비스 모드 (권장)
스케줄러가 활성화되어 정해진 시간에 자동으로 실행됩니다.

```powershell
# Windows
$env:DH_LOTTERY_ID="your_id"
$env:DH_LOTTERY_PW="your_password"
$env:TELEGRAM_BOT_TOKEN="your_bot_token"
$env:TELEGRAM_CHAT_ID="your_chat_id"
.\dhlottery.exe -service
```

```bash
# Ubuntu
export DH_LOTTERY_ID="your_id"
export DH_LOTTERY_PW="your_password"
export TELEGRAM_BOT_TOKEN="your_bot_token"
export TELEGRAM_CHAT_ID="your_chat_id"
./dhlottery -service
```

#### 2. 1회 구매 모드
즉시 로또를 1회 구매합니다.

```bash
./dhlottery -once
```

#### 3. 예치금 확인 모드
예치금만 확인합니다.

```bash
./dhlottery -check
```

### 환경변수 설정

#### Windows (PowerShell)

```powershell
$env:DH_LOTTERY_ID="your_id"
$env:DH_LOTTERY_PW="your_password"
$env:TELEGRAM_BOT_TOKEN="your_bot_token"
$env:TELEGRAM_CHAT_ID="your_chat_id"
```

#### Ubuntu (Bash)

```bash
export DH_LOTTERY_ID="your_id"
export DH_LOTTERY_PW="your_password"
export TELEGRAM_BOT_TOKEN="your_bot_token"
export TELEGRAM_CHAT_ID="your_chat_id"
```

### 설정 파일 사용

```bash
# config.json 생성
cp config.example.json config.json
nano config.json  # 계정 정보 입력
```

`config.json` 예시:
```json
{
  "userId": "your_id",
  "password": "your_password",
  "telegramBotToken": "your_bot_token",
  "telegramChatId": -1234567890
}
```

## 프로젝트 구조

```
DhLottery/
├── main.go                # 메인 프로그램
├── go.mod                 # Go 모듈 파일
├── go.sum                 # 의존성 체크섬
├── config.example.json    # 설정 파일 예시
├── .gitignore            # Git 제외 파일 목록
└── README.md             # 프로젝트 문서
```

## 주요 함수

### `NewDhLottery(config Config) (*DhLottery, error)`
새로운 동행복권 클라이언트를 생성합니다.

### `Login() error`
동행복권 사이트에 로그인합니다.
1. 로그인 페이지 접속 (쿠키 및 세션 획득)
2. Hidden 필드 추출 (CSRF 토큰 등)
3. 로그인 폼 데이터 전송
4. 로그인 성공 여부 확인

### `NavigateToLottoBuyPage() error`
로또 6/45 구매 페이지로 이동합니다.

### 설정 로드 함수

- `LoadConfigFromEnv()`: 환경변수에서 설정 로드
- `LoadConfigFromFile(filename)`: JSON 파일에서 설정 로드
- `LoadConfigInteractive()`: 사용자 입력으로 설정 로드

## 보안 고려사항

⚠️ **중요**: 이 프로그램은 학습 및 개인 사용 목적으로 작성되었습니다.

- ✅ 환경변수 사용 권장
- ✅ `config.json`은 `.gitignore`에 포함되어 있음
- ✅ 비밀번호는 로그에 마스킹 처리됨
- ⚠️ 프로덕션 환경에서는 더 강력한 보안 조치 필요

## 기술 스택

- **언어**: Go 1.24.0
- **HTTP 클라이언트**: net/http
- **HTML 파싱**: goquery (PuerkitoBio/goquery)
- **쿠키 관리**: cookiejar with publicsuffix

## 작동 원리

### 1. 설정 로드 (우선순위)
   1. 환경변수 (`DH_LOTTERY_ID`, `DH_LOTTERY_PW`)
   2. 설정 파일 (`config.json`)
   3. 대화형 입력

### 2. 로그인 프로세스
   - 로그인 페이지에서 CSRF 토큰 등 hidden 필드 추출
   - 계정 정보와 함께 POST 요청 전송
   - 쿠키 저장 및 세션 유지
   - JSESSIONID 쿠키 확인으로 로그인 검증

### 3. 페이지 이동
   - 로그인 후 쿠키를 사용하여 인증된 요청 전송
   - 로또 구매 페이지 (`ol.dhlottery.co.kr`) 접근
   - 페이지 내용 검증

### 4. 향후 기능
   - 로또 번호 자동 선택
   - 구매 금액 설정
   - 구매 확인 및 결과 저장
   - 당첨 번호 확인 자동화

## 실행 예시

### 성공적인 구매

```
==============================================
   동행복권 로또 자동 구매 프로그램 v1.0
==============================================

=== 로그인 시작 ===
✅ 로그인 성공!
✅ 로그인 완료! 세션이 정상적으로 생성되었습니다

=== 로또 6/45 구매 페이지 접근 ===
✅ 로또 6/45 구매 페이지 접근 성공!

=== 로또 자동 구매 ===
1단계: 로또 구매 페이지 접근 중...
   → 현재 회차: 1203회
   → 추첨일: 2025/12/20
   → 예치금 잔액: 20,000원
3단계: 구매 대기열 확인 중...
   → 대기열 없음, 즉시 구매 가능
4단계: 로또 구매 요청 중...
   💰 구매 금액: 5000원

╔════════════════════════════════════════╗
║          로또 6/45 구매 결과           ║
╚════════════════════════════════════════╝

✅ 구매가 성공적으로 완료되었습니다!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    구매 게임 수: 5 게임 (총 5,000원)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  🎱 [A 게임 (자동)]  08 - 19 - 23 - 35 - 38 - 41
  🎱 [B 게임 (자동)]  02 - 05 - 09 - 15 - 23 - 43
  🎱 [C 게임 (자동)]  08 - 14 - 29 - 36 - 37 - 38
  🎱 [D 게임 (자동)]  06 - 27 - 33 - 34 - 40 - 42
  🎱 [E 게임 (자동)]  06 - 08 - 22 - 38 - 40 - 44

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    추첨일: 2025-12-20
    당첨금 지급기한: 2026-12-21
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 구매가 완료되었습니다. 행운을 빕니다!
```

### 한도 초과 시

```
╔════════════════════════════════════════╗
║          로또 6/45 구매 결과           ║
╚════════════════════════════════════════╝

❌ 구매 실패

   사유: [온라인복권 주간 구매한도] 초과되었습니다.

   💡 이번 회차에 이미 최대 한도(5,000원)를 구매하셨습니다.
      온라인으로는 1회차당 최대 5게임까지만 구매 가능합니다.
```

## 문제 해결

### 로그인 실패
- 계정 정보가 정확한지 확인하세요
- 동행복권 사이트가 정상 작동하는지 확인하세요
- 방화벽이나 보안 프로그램이 차단하는지 확인하세요
- 환경변수 또는 설정 파일이 올바르게 설정되었는지 확인하세요

### 구매 페이지 접근 실패
- 로그인이 성공했는지 확인하세요
- 동행복권 사이트의 구조가 변경되었을 수 있습니다
- 네트워크 연결을 확인하세요

### 환경변수가 작동하지 않음
```powershell
# 환경변수 확인
echo $env:DH_LOTTERY_ID
echo $env:DH_LOTTERY_PW

# 환경변수가 설정되지 않았다면 다시 설정
$env:DH_LOTTERY_ID="your_id"
$env:DH_LOTTERY_PW="your_password"
```

## 빌드 방법

```powershell
# Windows 실행 파일 생성
go build -o dhlottery.exe main.go

# 실행
.\dhlottery.exe
```

## 개발 로그

- 2024-12-14: 초기 버전 개발
  - 로그인 기능 구현
  - 로또 6/45 구매 페이지 접근
  - 환경변수/설정파일/대화형 입력 지원
  - 보안 강화 (비밀번호 마스킹, .gitignore)

## 라이선스

개인 사용 목적으로만 사용하세요.

## 주의사항

- ⚠️ 이 프로그램은 동행복권의 공식 API가 아닙니다
- ⚠️ 사이트 구조 변경 시 동작하지 않을 수 있습니다
- ⚠️ 과도한 요청으로 인한 계정 제재 가능성이 있으니 주의하세요
- ⚠️ 책임감 있는 복권 구매를 권장합니다
- ⚠️ 계정 정보는 안전하게 관리하세요

## 향후 개발 계획

- [x] 로그인 자동화
- [x] 로또 구매 페이지 접근
- [x] 자동번호 발급 기능
- [x] 실제 구매 완료 기능
- [x] 구매 결과 및 번호 출력
- [x] 텔레그램 알림 기능
- [x] 스케줄러 (Cron) 기능
- [x] 서비스 모드
- [ ] 수동 번호 선택 기능
- [ ] 당첨 번호 자동 확인
- [ ] 구매 내역 저장 (JSON/CSV)
- [ ] GUI 인터페이스
- [ ] 다중 계정 지원

## 텔레그램 봇 설정

### 1. 봇 생성
1. 텔레그램에서 @BotFather 검색
2. `/newbot` 명령어로 봇 생성
3. Bot Token 복사

### 2. 그룹 채팅 ID 확인
1. 봇을 그룹에 추가
2. 봇을 관리자로 승격
3. 다음 URL로 chat_id 확인:
   ```
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```

### 3. 환경변수 설정
```bash
export TELEGRAM_BOT_TOKEN="your_bot_token"
export TELEGRAM_CHAT_ID="your_chat_id"
```

## 알림 예시

### 예치금 부족 알림
```
⚠️ 예치금 부족 알림

현재 예치금: 5,000원
기준 금액: 10,000원

💡 예치금을 충전해주세요!
```

### 구매 성공 알림
```
✅ 로또 구매 성공!

💰 구매 금액: 5,000원
🎱 구매 게임: 5게임

[A (자동)] 08 - 19 - 23 - 35 - 38 - 41
[B (자동)] 02 - 05 - 09 - 15 - 23 - 43
[C (자동)] 08 - 14 - 29 - 36 - 37 - 38
[D (자동)] 06 - 27 - 33 - 34 - 40 - 42
[E (자동)] 06 - 08 - 22 - 38 - 40 - 44

📅 추첨일: 2025-12-20

💡 행운을 빕니다!
```

### 구매 실패 알림 (한도 초과)
```
❌ 구매 실패

사유: [온라인복권 주간 구매한도] 초과되었습니다.

💡 이번 회차에 이미 최대 한도(5,000원)를 구매하셨습니다.
```

## 기여

이슈나 풀 리퀘스트는 언제든 환영합니다!

## 문의

문제가 발생하거나 질문이 있으시면 이슈를 등록해주세요.

